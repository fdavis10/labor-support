# Production: используйте с подготовленными .env из *.production.
# Запуск: docker compose -f docker-compose.yml -f docker-compose.production.yml up -d --build
# Или скопируйте .env.production → .env и backend/.env.production → backend/.env, затем:
#   docker compose -f docker-compose.production.yml up -d --build

services:
  db:
    restart: unless-stopped

  backend:
    env_file: ./backend/.env
    restart: unless-stopped

  web:
    build:
      context: ./frontend
      dockerfile: Dockerfile.production
    ports:
      - "${HTTP_PORT:-80}:80"
      - "443:443"
    volumes:
      - backend_static:/var/www/backend-static:ro
      - ./docker/certs:/etc/nginx/certs:ro
      # Для Let's Encrypt: certbot пишет сюда, Nginx отдаёт /.well-known/acme-challenge/
      - ./docker/acme-challenge:/var/www/acme:ro
    depends_on:
      - backend
    restart: unless-stopped
